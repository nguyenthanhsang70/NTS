<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memory Card - NTS</title>
<link rel="icon" type="image/png" href="logos3.png">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #ff00c7;
    --secondary: #ff9f00;
    --dark-bg: #1a1a2e;
    --card-bg: #fff;
    --card-pattern: #0f3460;
  }

  body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--dark-bg);
    /* Tạo nền giả lập mặt bàn nỉ hoặc không gian tối */
    background-image: radial-gradient(circle at 50% 50%, #2a2a4e 0%, #16213e 100%);
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 20px;
    overflow-x: hidden;
  }

  /* --- Hiệu ứng ánh sáng nền --- */
  body::before {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 50% 0%, rgba(255, 0, 199, 0.15), transparent 60%);
    pointer-events: none;
    z-index: -1;
  }

  header h1 {
    font-size: 3rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 4px;
    background: linear-gradient(to bottom, #fff, #aaa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 10px 20px rgba(0,0,0,0.5);
    margin: 0 0 20px 0;
  }

  /* --- Bảng thông số kính mờ --- */
  .game-info {
    display: flex;
    justify-content: space-between;
    width: 100%;
    max-width: 850px;
    margin-bottom: 25px;
    padding: 15px 30px;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
  }

  .game-info span {
    font-size: 1.2rem;
    font-weight: 600;
    color: #e0e0e0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  /* --- Lưới thẻ bài --- */
  .game-board {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 12px;
    width: 100%;
    max-width: 850px;
    perspective: 1200px; /* Tăng chiều sâu 3D */
    margin-bottom: 30px;
  }

  /* --- Thiết kế thẻ bài Realistic --- */
  .card {
    position: relative;
    width: 100%;
    aspect-ratio: 2 / 3; /* Tỉ lệ giống bài thật hơn là hình vuông */
    transform-style: preserve-3d;
    transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Hiệu ứng nảy nhẹ */
    cursor: pointer;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }

  .card:hover {
    transform: translateY(-5px) scale(1.02); /* Nhấc nhẹ khi hover */
    box-shadow: 0 15px 25px rgba(0,0,0,0.4);
  }

  .card.flipped {
    transform: rotateY(180deg);
  }

  .card.matched {
    animation: pulseMatch 0.5s ease-in-out forwards;
    pointer-events: none;
  }

  @keyframes pulseMatch {
    0% { transform: rotateY(180deg) scale(1); box-shadow: 0 0 0 rgba(255,255,255,0); }
    50% { transform: rotateY(180deg) scale(1.1); box-shadow: 0 0 30px rgba(255,215,0,0.8); }
    100% { transform: rotateY(180deg) scale(1); opacity: 0.5; filter: grayscale(100%); }
  }

  .card-front, .card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 8px;
    overflow: hidden;
    border: 2px solid rgba(255,255,255,0.1);
  }

  /* --- Mặt sau thẻ (Lưng bài) --- */
  .card-front {
    /* Tạo họa tiết caro chéo giống bài thật */
    background-color: #16213e;
    background-image: 
      repeating-linear-gradient(45deg, rgba(255,255,255,0.05) 0px, rgba(255,255,255,0.05) 2px, transparent 2px, transparent 10px),
      repeating-linear-gradient(-45deg, rgba(255,255,255,0.05) 0px, rgba(255,255,255,0.05) 2px, transparent 2px, transparent 10px);
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  /* Logo ở giữa lưng bài (Tuỳ chọn) */
  .card-front::after {
    content: '?';
    font-size: 2rem;
    font-weight: bold;
    color: rgba(255,255,255,0.1);
    border: 2px solid rgba(255,255,255,0.1);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* --- Mặt trước thẻ (Hình ảnh) --- */
  .card-back {
    background: #fff;
    transform: rotateY(180deg);
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 5px; /* Viền trắng bảo vệ ảnh */
    box-sizing: border-box;
  }

  .card-back img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 4px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
  }

  /* --- Nút bấm --- */
  .controls {
    display: flex;
    gap: 15px;
  }

  .btn {
    padding: 12px 30px;
    font-size: 1rem;
    font-weight: bold;
    text-transform: uppercase;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }

  .btn-primary {
    background: linear-gradient(90deg, #ff00c7, #ff9f00);
    color: white;
  }
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255, 0, 199, 0.4);
  }

  .btn-secondary {
    background: rgba(255,255,255,0.1);
    color: white;
    border: 1px solid rgba(255,255,255,0.2);
  }
  .btn-secondary:hover {
    background: rgba(255,255,255,0.2);
  }

  /* --- Màn hình thắng --- */
  .win-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(8px);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 100;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
  }

  .win-overlay.show {
    opacity: 1;
    pointer-events: all;
  }

  .win-card {
    background: rgba(255, 255, 255, 0.1);
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    border: 1px solid rgba(255,255,255,0.2);
    box-shadow: 0 0 50px rgba(255, 0, 199, 0.3);
    transform: scale(0.8);
    transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  .win-overlay.show .win-card {
    transform: scale(1);
  }

  .win-card h2 {
    font-size: 3.5rem;
    margin: 0 0 10px 0;
    background: linear-gradient(90deg, #ff00c7, #ff9f00);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  /* Canvas cho pháo hoa */
  #confetti-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 99;
  }

  /* Responsive */
  @media (max-width: 900px) {
    .game-board { grid-template-columns: repeat(6, 1fr); max-width: 600px; }
  }
  @media (max-width: 600px) {
    .game-board { grid-template-columns: repeat(4, 1fr); gap: 8px; }
    .card { aspect-ratio: 1/1; } /* Mobile để vuông cho dễ nhìn */
    header h1 { font-size: 2rem; }
  }
</style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<header>
  <h1>Memory Card</h1>
</header>

<div class="game-info">
  <span><i style="color:#ff9f00">★</i> Cặp: <b id="pairs">0/20</b></span>
  <span><i style="color:#03dac6">⏱</i> Thời gian: <b id="timer">00:00</b></span>
</div>

<div class="game-board" id="gameBoard"></div>

<div class="controls">
  <button class="btn btn-primary" id="restartBtn">Chơi Mới</button>
  <a href="#" class="btn btn-secondary" id="backBtn">Thoát</a>
</div>

<div class="win-overlay" id="winMessage">
  <div class="win-card">
    <h2>CHIẾN THẮNG!</h2>
    <p style="font-size: 1.2rem; margin-bottom: 30px;" id="winStats">Thời gian: 00:00</p>
    <button class="btn btn-primary" id="playAgainBtn">Chơi Lại Ngay</button>
  </div>
</div>

<audio id="soundFlip" src="flip.mp3"></audio>
<audio id="soundMatch" src="match.mp3"></audio>
<audio id="soundWin" src="win.mp3"></audio>

<script>
  // --- CẤU HÌNH TRÒ CHƠI ---
  const cardImages = [
    'thẻ1.jpg', 'the2.jpg', 'the3.jpg', 'the4.jpg', 
    'the5.jpg', 'thẻ6.png', 'thẻ7.jpg', 'thẻ8.png',
    'thẻ9.jpg', 'thẻ10.jpg', 'thẻ11.jpg', 'thẻ12.jpg',
    'thẻ13.png', 'thẻ14.png', 'thẻ15.jpg', 'thẻ16.jpg',
    'thẻ17.jpg', 'thẻ18.jpg', 'thẻ19.png', 'thẻ20.jpg'
  ];

  let gameState = {
    cards: [],
    flippedCards: [],
    matchedPairs: 0,
    timer: 0,
    timerInterval: null,
    canFlip: true,
    totalPairs: 20
  };

  const elements = {
    gameBoard: document.getElementById('gameBoard'),
    pairsDisplay: document.getElementById('pairs'),
    timerDisplay: document.getElementById('timer'),
    winMessage: document.getElementById('winMessage'),
    winStats: document.getElementById('winStats'),
    // Âm thanh (Optional: tạo dummy object nếu không tìm thấy element)
    soundFlip: document.getElementById('soundFlip') || { play: ()=>{} },
    soundMatch: document.getElementById('soundMatch') || { play: ()=>{} },
    soundWin: document.getElementById('soundWin') || { play: ()=>{} },
  };

  // --- LOGIC TRÒ CHƠI ---

  function initGame() {
    document.getElementById('restartBtn').addEventListener('click', createBoard);
    document.getElementById('playAgainBtn').addEventListener('click', createBoard);
    createBoard();
  }

  function createBoard() {
    resetGameState();
    
    // Tạo 20 cặp thẻ
    gameState.cards = [];
    for (let i = 0; i < gameState.totalPairs; i++) {
      const imgIndex = i % cardImages.length;
      // Thêm ID unique để tránh lỗi logic
      gameState.cards.push(
        { id: i*2, image: cardImages[imgIndex], val: i },
        { id: i*2+1, image: cardImages[imgIndex], val: i }
      );
    }
    
    shuffleCards();
    renderBoard();
    startTimer();
  }

  function resetGameState() {
    gameState.flippedCards = [];
    gameState.matchedPairs = 0;
    gameState.timer = 0;
    gameState.canFlip = true;
    clearInterval(gameState.timerInterval);
    
    updateUI();
    elements.winMessage.classList.remove('show');
    stopConfetti(); // Dừng pháo hoa nếu có
  }

  function shuffleCards() {
    gameState.cards.sort(() => Math.random() - 0.5);
  }

  function renderBoard() {
    elements.gameBoard.innerHTML = '';
    
    gameState.cards.forEach((card, index) => {
      const cardElement = document.createElement('div');
      cardElement.classList.add('card');
      cardElement.dataset.index = index;

      // HTML structure tối ưu hơn
      cardElement.innerHTML = `
        <div class="card-front"></div>
        <div class="card-back">
          <img src="${card.image}" alt="Card" onerror="this.src='https://via.placeholder.com/150?text=IMG'">
        </div>
      `;

      cardElement.addEventListener('click', () => handleCardClick(cardElement));
      elements.gameBoard.appendChild(cardElement);
    });
  }

  function handleCardClick(cardElement) {
    const index = parseInt(cardElement.dataset.index);

    // Logic chặn click
    if (!gameState.canFlip || 
        cardElement.classList.contains('flipped') || 
        cardElement.classList.contains('matched')) {
      return;
    }

    // Lật thẻ
    flipCard(cardElement);
    gameState.flippedCards.push({ element: cardElement, index: index });

    if (gameState.flippedCards.length === 2) {
      checkForMatch();
    }
  }

  function flipCard(cardElement) {
    cardElement.classList.add('flipped');
    playSound(elements.soundFlip); // Âm thanh lật
  }

  function checkForMatch() {
    gameState.canFlip = false;
    const [card1, card2] = gameState.flippedCards;
    const val1 = gameState.cards[card1.index].val;
    const val2 = gameState.cards[card2.index].val;

    if (val1 === val2) {
      // Match found
      setTimeout(() => {
        card1.element.classList.add('matched');
        card2.element.classList.add('matched');
        gameState.matchedPairs++;
        playSound(elements.soundMatch); // Âm thanh khớp
        
        gameState.flippedCards = [];
        gameState.canFlip = true;
        updateUI();

        if (gameState.matchedPairs === gameState.totalPairs) {
          endGame();
        }
      }, 500); // Đợi lật xong mới hiện hiệu ứng match
    } else {
      // No match
      setTimeout(() => {
        card1.element.classList.remove('flipped');
        card2.element.classList.remove('flipped');
        gameState.flippedCards = [];
        gameState.canFlip = true;
      }, 1000); // Đợi lâu hơn xíu để người chơi kịp nhớ
    }
  }

  function startTimer() {
    gameState.timerInterval = setInterval(() => {
      gameState.timer++;
      updateTimerDisplay();
    }, 1000);
  }

  function updateTimerDisplay() {
    const m = Math.floor(gameState.timer / 60).toString().padStart(2, '0');
    const s = (gameState.timer % 60).toString().padStart(2, '0');
    elements.timerDisplay.textContent = `${m}:${s}`;
  }

  function updateUI() {
    elements.pairsDisplay.textContent = `${gameState.matchedPairs}/${gameState.totalPairs}`;
  }

  function endGame() {
    clearInterval(gameState.timerInterval);
    const m = Math.floor(gameState.timer / 60).toString().padStart(2, '0');
    const s = (gameState.timer % 60).toString().padStart(2, '0');
    
    elements.winStats.textContent = `Hoàn thành trong: ${m} phút ${s} giây`;
    elements.winMessage.classList.add('show');
    playSound(elements.soundWin);
    startConfetti(); // Bắn pháo hoa
  }

  // Hàm helper chơi âm thanh an toàn
  function playSound(audioEl) {
    if(audioEl && audioEl.readyState >= 2) {
      audioEl.currentTime = 0;
      audioEl.play().catch(e => console.log("Cần tương tác user để play audio"));
    }
  }

  // --- HIỆU ỨNG PHÁO HOA (Confetti) ---
  // Script nhỏ gọn tự viết không cần thư viện ngoài
  let confettiCtx = document.getElementById('confetti-canvas').getContext('2d');
  let confettiActive = false;
  let particles = [];

  function resizeCanvas() {
    confettiCtx.canvas.width = window.innerWidth;
    confettiCtx.canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeCanvas);

  function startConfetti() {
    resizeCanvas();
    confettiActive = true;
    particles = [];
    for(let i=0; i<150; i++) {
      particles.push({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight - window.innerHeight,
        color: `hsl(${Math.random() * 360}, 100%, 50%)`,
        size: Math.random() * 10 + 5,
        speedY: Math.random() * 3 + 2,
        speedX: Math.random() * 4 - 2,
        spin: Math.random() * 0.2 - 0.1
      });
    }
    animateConfetti();
  }

  function stopConfetti() {
    confettiActive = false;
    confettiCtx.clearRect(0, 0, window.innerWidth, window.innerHeight);
  }

  function animateConfetti() {
    if(!confettiActive) return;
    confettiCtx.clearRect(0, 0, window.innerWidth, window.innerHeight);
    
    particles.forEach(p => {
      p.y += p.speedY;
      p.x += Math.sin(p.y * 0.01) + p.speedX;
      p.size += p.spin; // Hiệu ứng xoay giả
      
      confettiCtx.fillStyle = p.color;
      confettiCtx.beginPath();
      confettiCtx.arc(p.x, p.y, Math.abs(p.size), 0, Math.PI * 2);
      confettiCtx.fill();

      if(p.y > window.innerHeight) p.y = -10;
    });
    
    requestAnimationFrame(animateConfetti);
  }

  // Khởi chạy
  initGame();

</script>
</body>
</html>


